- name: Install Nix Package Manager
  block:
    - name: Install Nix Package Manager [1/3]
      shell: |
        set -o pipefail &&
        curl -L https://nixos.org/nix/install | sh
      args:
        executable: /bin/bash
        creates: "/nix/var/nix/profiles/default/bin/nix"

    - name: Install Nix Package Manager [2/3]
      ansible.builtin.lineinfile:
        path: "{{ ansible_env.HOME }}/.config/nix/nix.conf"
        line: experimental-features = nix-command flakes
        create: true